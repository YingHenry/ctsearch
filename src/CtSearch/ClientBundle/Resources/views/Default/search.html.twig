<html>

<head>
    <title>CtSearch search</title>
    {% stylesheets '@CtSearchClientBundle/Resources/public/css/*' filter='cssrewrite' %}
    <link rel="stylesheet" type="text/css" href="{{ asset_url }}"/>
    {% endstylesheets %}
    {% javascripts '@CtSearchClientBundle/Resources/public/js/*' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <style type="text/css">
        a.ajax-link{
        {% image '@CtSearchClientBundle/Resources/public/images/loading_small.gif' %}
            background:url('{{ asset_url }}') no-repeat -2em -2em;
        {% endimage %}
        }
    </style>
    {% image '@CtSearchClientBundle/Resources/public/images/logo.png' %}
    <link rel="icon" type="image/png" href="{{ asset_url }}" />
    {% endimage %}
</head>
<body>
<main>
    <div class="search-form">
        <div class="logo">
            {% image '@CtSearchClientBundle/Resources/public/images/logo.png' %}
            <img src="{{ asset_url }}" alt="Logo CtSearch" />
            {% endimage %}
        </div>
        <form method="get" action="">
            <input type="hidden" name="mapping" value="{{ context.mapping }}"/>
            <input type="hidden" name="analyzer" value="{{ context.analyzer }}"/>
            <input type="hidden" name="size" value="{{ context.size }}"/>
            <input type="hidden" name="facets" value="{{ context.requestedFacets }}"/>
            <input type="hidden" name="searchParams" value="{{ searchParamsStr }}"/>
            <div class="form-item">
                <input type="text" name="query" value="{{ context.query }}"/>
            </div>
            <div class="form-action">
                <input type="submit" value="Search"/>
            </div>
        </form>
    </div>
    <!--{{ dump(context) }}-->
    {% if facets is defined and facets is not empty %}
        <div class="facets">
            {% for facet_name, facet_label in searchParams.facets %}
                {% if facets[facet_name] is defined %}
                    {% set facet = facets[facet_name] %}
                    {% if facet.buckets|length > 0 %}
                        <div id="facet-block-{{ facet_name|replace('.', '_') }}" class="facet-block">
                            {% if searchParams.facets[facet_name] is defined %}
                                <h2>{{ searchParams.facets[facet_name] }}</h2>
                            {% else %}
                                <h2>{{ facet_name }}</h2>
                            {% endif %}
                            <ul class="facet-list">
                                {% for value in facet.buckets %}
                                    {% if value.applied %}
                                        <li>{{ value.key }} ({{ value.doc_count }}) <a href="{{ value.facet_link }}"
                                                                                       class="remove-filter ajax-link">Remove</a></li>
                                    {% else %}
                                        <li><a href="{{ value.facet_link }}" class="ajax-link">{{ value.key }}</a> ({{ value.doc_count }})
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                            {% if facet.see_more_link is defined %}
                                <div class="see-more">
                                    <a href="{{ facet.see_more_link }}" class="ajax-link">See more</a>
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
    <div class="results">
        <div class="search-stat"><strong>{{ context.total }}</strong> results</div>
        <div class="results-list">
            <ul>
                {% for result in context.results %}
                    <li>
                        {% if result._source[searchParams.results.thumbnail] is defined %}
                            <div class="thumbnail"><img src="{{ result._source[searchParams.results.thumbnail] }}" /></div>
                        {% endif %}
                        {% if result._source[searchParams.results.title] is defined %}
                            {% set title = result._source[searchParams.results.title] %}
                            {% if result.highlight[searchParams.results.title] is defined %}
                                {% set title = result.highlight[searchParams.results.title]|join(' ') %}
                            {% endif %}
                        {% else %}
                            {% set title = 'No title defined' %}
                        {% endif %}
                        {% if result._source[searchParams.results.url] is defined %}
                            <h3><a href="{{ result._source[searchParams.results.url] }}"
                                   target="_blank">{{ title|raw }}</a>
                            </h3>
                            <div class="url"><a href="{{ result._source[searchParams.results.url] }}"
                                                target="_blank">{{ result._source[searchParams.results.url] }}</a></div>
                        {% else %}
                            <h3>{{ title|raw }}</h3>
                        {% endif %}
                        {% if result._source[searchParams.results.excerp] is defined %}
                            {% set excerp = result._source[searchParams.results.excerp] %}
                            {% if result.highlight[searchParams.results.excerp] is defined %}
                                {% set excerp = result.highlight[searchParams.results.excerp]|join('[...]') %}
                            {% endif %}
                        {% else %}
                            {% set excerp = '' %}
                        {% endif %}
                        {% if excerp != '' %}
                        <div class="excerp">
                            {{ excerp|striptags('<em>')|raw }}
                        </div>
                        {% endif %}
                        <div class="source">
                            {{ result|json_encode() }}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="pager">
            {{ pager|raw }}
        </div>
    </div>
</main>
</body>
</html>